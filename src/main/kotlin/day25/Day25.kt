package day25

import kotlin.math.pow

fun main () {
    println(toSnafu(realInput.lines().sumOf { fromSnafu(it) }))
}

fun toSnafu(number: Long): String {
    var result = ""
    var rest = number
    while (rest > 0 ) {
        val remainder = rest % 5
        result = when (remainder) {
            0L -> "0$result"
            1L -> "1$result"
            2L -> "2$result"
            3L -> "=$result"
            4L -> "-$result"
            else -> throw IllegalArgumentException()
        }
        rest /= 5
        if (remainder > 2) {
            rest += 1
        }
    }
    return result
}
fun fromSnafu(snafu: String): Long = snafu.reversed().mapIndexed { index, c ->
    5L.pow(index.toLong()) * when (c) {
        '0' -> 0L
        '1' -> 1L
        '2' -> 2L
        '-' -> -1L
        '=' -> -2L
        else -> throw IllegalArgumentException()
    }
}.sum()

fun Long.pow(rhs: Long) = toDouble().pow(rhs.toDouble()).toLong()

val testInput = """1=-0-2
12111
2=0=
21
2=01
111
20012
112
1=-1=
1-12
12
1=
122"""

val realInput = """1=120=22222-=10-=
1--22-=-
21
1=0222=-1=-0--220=02
122102
22--=20==2===201
100-1-01=0-1
20200-2==220120-
2220-2200=000=
1==002=221-2
2--221-22=
1022=121=1-22=-01
2=1=1-1=02-=02=2=
1-21112=02
2=1-22021
1---=-221=-22122
10020
1=--101
1=12=02-1--12
1=0-=1002020-2=
120=1==201102==2==
2==-=0120112=2-=-
1---1
12=2--02-00==-22
12==1-=0-2=0--11--
1=10=0-1221
1=201-0-
22
10-0=21-2-1-2-=211
1=1--12==0=--1
2=-1022=1=-10-
12-02-2-
1=-1=00---
1=100120=101
112=01
20-22=00-=1=1=10
200--=0-221101=
10-2=01=-20
10=11=1
20-1-
2=012-002-02-1221
1==1=1-012100
10=221202-0-0-
1-0121-
2==1100-=
102=022=202
2=2-
21-2=12-22-1
1-2100
1-200101==0
2==0200-12012-=1=02
1=1010-2=22=2
1-2=-12-2-2=112=120
1=-=-
2-=
100=0-1-1=000
11=1-=2--00=0=2-=1
1221120122=11110-
111=10-002=
20=-=200
2==21
1=--2=-=2-102211
20=1=-0=1=
12
202=-0-=1220-0
1=0112=1-=-1
21-=-===0=-122000
1=
112010-11221=-00
112-2==102=2-1=1
1==-0=
1=01-11-211
21=-1-20--2=202122
1=01
20221
100
10=22-1=-1121-2
2-0=-
101012-200=010=
1011=0011
1-0202=0-11
101==10
10=
10111-1=-0
1112=0101=-
11=0=-1111-000
12=11
1102222=20
2=0=--==022-
11222
2100=
1=-0
12-11-2=-222-
1-10-012=21-0
1-2=
112
111=20
1221=-2
1===1==0010=0-
1-=1-==-=20"""
